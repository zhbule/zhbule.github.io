<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <title>管理员中心 - 小猫网</title>
    <link href="css/css.css" rel="stylesheet" />
</head>

<body>
    <div class="logo">
        <a href="#"><img src="images/logo.jpg" /></a>
    </div>
    <div class="nav">
        <ul>
            <li><a href="index.html"><img src="images/nav1.jpg" />首页</a></li>
            <li><a href="zhidao.html"><img src="images/nav2.jpg" />养猫知道</a></li>
            <li><a href="jieshao.html"><img src="images/nav3.jpg" />小猫介绍</a></li>
            <li><a href="tuji.html"><img src="images/nav4.jpg" />小猫图集</a></li>
            <li><a href="lingyang.html"><img src="images/nav5.jpg" />领养小猫</a></li>
            <li><a href="liuyan.html"><img src="images/nav6.jpg" />在线留言</a></li>
        </ul>
    </div>
    <div class="topsite">
        <div class="sear">
            <input type="text" class="text" />
            <input type="button" class="btn" value="搜索">
        </div>
        <div class="link">
            <span>热门搜索：</span>
            <a href="jieshao.html#buoumao">布偶猫</a>
            <a href="jieshao.html#lanjianceng">蓝渐层</a>
            <a href="jieshao.html#meiduan">美短</a>
        </div>
    </div>

    <div class="main">
        <div class="left" style="width: 250px;">
            <div class="gonggao" style="height: auto; padding-bottom: 20px;">
                <h3>管理员菜单</h3>
                <div style="padding: 10px;">
                    <p><a href="#userList" style="color: #333; display: block; line-height: 30px;">用户管理</a></p>
                    <p><a href="#adminInfo" style="color: #333; display: block; line-height: 30px;">管理员信息</a></p>
                    <p><a href="javascript:;" id="logoutBtn"
                            style="color: #333; display: block; line-height: 30px;">退出登录</a></p>
                </div>
            </div>
        </div>

        <div class="min" style="width: 680px;">
            <div id="userList" style="background: #f9f9f9; padding: 20px; border-radius: 5px;">
                <h2 style="text-align: left; border-bottom: 1px solid #00b8ee; padding-bottom: 10px;">用户管理</h2>
                <div id="usersContainer" style="margin-top: 20px;">
                    <!-- 用户列表将通过JS动态生成 -->
                </div>
            </div>

            <div id="adminInfo" style="background: #f9f9f9; padding: 20px; border-radius: 5px; margin-top: 20px;">
                <h2 style="text-align: left; border-bottom: 1px solid #00b8ee; padding-bottom: 10px;">管理员信息</h2>
                <table style="width: 100%; margin-top: 20px; line-height: 2;">
                    <tr>
                        <td style="width: 120px; text-align: right; padding-right: 20px;">管理员账号：</td>
                        <td id="adminUsername">-</td>
                    </tr>
                    <tr>
                        <td style="text-align: right; padding-right: 20px;">角色：</td>
                        <td>系统管理员</td>
                    </tr>
                    <tr>
                        <td colspan="2" style="padding-top: 10px;">
                            <input type="button" value="修改密码" class="btn" id="changePwdBtn"
                                style="margin-left: 140px; cursor: pointer;">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>小猫网</p>
    </div>

    <script>
        // 页面加载时验证管理员身份
        document.addEventListener('DOMContentLoaded', function () {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');

            // 验证是否为管理员登录
            if (!currentUser || currentUser.role !== 'admin') {
                alert('请使用管理员账号登录');
                window.location.href = 'admin_login.html';
                return;
            }

            // 显示管理员信息
            document.getElementById('adminUsername').textContent = currentUser.username;

            // 加载用户列表
            loadUserList();

            // 退出登录
            document.getElementById('logoutBtn').addEventListener('click', function () {
                if (confirm('确定要退出登录吗？')) {
                    localStorage.removeItem('currentUser');
                    window.location.href = 'index.html';
                }
            });

            // 修改管理员密码
            document.getElementById('changePwdBtn').addEventListener('click', function () {
                const oldPwd = prompt('请输入原密码：');
                if (oldPwd !== currentUser.password) {
                    alert('原密码错误');
                    return;
                }

                const newPwd = prompt('请输入新密码（不少于6位）：');
                if (!newPwd || newPwd.length < 6) {
                    alert('密码长度不能少于6位');
                    return;
                }

                const confirmPwd = prompt('请确认新密码：');
                if (newPwd !== confirmPwd) {
                    alert('两次密码输入不一致');
                    return;
                }

                // 更新管理员密码
                currentUser.password = newPwd;
                localStorage.setItem('adminAccount', JSON.stringify(currentUser));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                alert('密码修改成功，请重新登录');
                window.location.href = 'admin_login.html';
            });
        });

        // 加载用户列表
        function loadUserList() {
            const users = JSON.parse(localStorage.getItem('petUsers') || '[]');
            const container = document.getElementById('usersContainer');

            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">暂无注册用户</p>';
                return;
            }

            // 创建用户列表表格
            let html = `
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background-color: #eee;">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">用户名</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">手机号</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">注册时间</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">操作</th>
            </tr>
    `;

            users.forEach((user, index) => {
                html += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">${user.username}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">${user.phone}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">${user.registerTime}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                    <button class="btn" style="padding: 3px 8px;" onclick="deleteUser(${index})">删除</button>
                </td>
            </tr>
        `;
            });

            html += '</table>';
            container.innerHTML = html;
        }

        // 删除用户
        function deleteUser(index) {
            if (confirm('确定要删除该用户吗？')) {
                const users = JSON.parse(localStorage.getItem('petUsers') || '[]');
                users.splice(index, 1);
                localStorage.setItem('petUsers', JSON.stringify(users));
                loadUserList(); // 重新加载用户列表
                alert('用户已删除');
            }
        }
    </script>
</body>

</html>